<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«‹é«”å¡ç‰‡è¨­è¨ˆå·¥å…· - å®Œæ•´ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 0;
        }
        
        .sidebar {
            width: 380px;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            z-index: 100;
            flex-shrink: 0;
        }
        
        .main-canvas {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-width: 0;
        }
        
        #canvas {
            flex: 1;
            width: 100%;
            height: 100%;
            display: block;
            cursor: grab;
        }
        
        #canvas:active {
            cursor: grabbing;
        }
        
        .controls-bar {
            background: white;
            padding: 12px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
            flex-shrink: 0;
        }
        
        .control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            white-space: nowrap;
        }
        
        .control label {
            margin: 0;
            font-weight: 500;
        }
        
        .control input[type="range"] {
            width: 120px;
            cursor: pointer;
        }
        
        .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section h3 {
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            font-size: 0.85em;
            color: #555;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            font-family: inherit;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .option {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 0.8em;
            transition: all 0.3s;
            background: white;
            font-weight: 500;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f5f7ff;
        }
        
        .option.active {
            border-color: #667eea;
            background: #e8eaf6;
            color: #667eea;
            font-weight: 600;
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }
        
        .color-box {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .color-box:hover {
            transform: scale(1.05);
        }
        
        .color-box.active {
            border-color: #333;
            box-shadow: 0 0 0 1px white, 0 0 0 3px #667eea;
        }
        
        .button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e8eaf6;
            color: #667eea;
        }
        
        .btn-secondary:hover {
            background: #dde2f0;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.85em;
            display: inline-block;
            width: auto;
            margin: 0 4px 0 0;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-top: 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 0.85em;
        }
        
        .info-value {
            font-weight: 600;
            color: #667eea;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }
        
        .sidebar h2 {
            margin-bottom: 20px;
            color: #667eea;
            font-size: 1.3em;
        }
        
        .drag-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 50;
        }
        
        .main-canvas:hover .drag-hint {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å·¦å´é‚Šæ¬„ -->
        <div class="sidebar">
            <h2>ğŸ¨ ç«‹é«”å¡ç‰‡è¨­è¨ˆå·¥å…·</h2>
            
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="section">
                <h3>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                <div class="form-group">
                    <label>é …ç›®åç¨±</label>
                    <input type="text" id="projectName" placeholder="ä¾‹ï¼šè–èª•ç¯€å¡ç‰‡">
                </div>
                <div class="form-group">
                    <label>å¡ç‰‡å¯¬åº¦ (cm)</label>
                    <input type="number" id="cardWidth" min="5" max="30" value="16" step="0.5">
                </div>
                <div class="form-group">
                    <label>å¡ç‰‡é«˜åº¦ (cm)</label>
                    <input type="number" id="cardHeight" min="5" max="30" value="20" step="0.5">
                </div>
            </div>
            
            <!-- çµæ§‹é¡å‹ -->
            <div class="section">
                <h3>ğŸ—ï¸ æ ¸å¿ƒçµæ§‹</h3>
                <div class="option-grid">
                    <div class="option active" data-mechanism="vfold">Vå‹æ‘º</div>
                    <div class="option" data-mechanism="parallel">å¹³è¡Œæ‘º</div>
                    <div class="option" data-mechanism="floating">æ‡¸æµ®å±¤</div>
                    <div class="option" data-mechanism="pulltab">æ‹‰å‹•æ©Ÿé—œ</div>
                    <div class="option" data-mechanism="spinner">æ—‹è½‰æ©Ÿé—œ</div>
                </div>
            </div>
            
            <!-- ç´™å¼µé¸æ“‡ -->
            <div class="section">
                <h3>ğŸ“„ ç´™å¼µé¸æ“‡</h3>
                <div class="form-group">
                    <label>åŸºåº•å¡ç‰‡</label>
                    <select id="baseCardType">
                        <option value="250gsm">250 GSM</option>
                        <option value="300gsm" selected>300 GSM (æ¨è–¦)</option>
                        <option value="350gsm">350 GSM (åšé‡)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç«‹é«”å…ƒä»¶</label>
                    <select id="elementCardType">
                        <option value="180gsm">180 GSM (è¼•è–„)</option>
                        <option value="200gsm">200 GSM</option>
                        <option value="220gsm" selected>220 GSM (æ¨è–¦)</option>
                    </select>
                </div>
            </div>
            
            <!-- é¡è‰² -->
            <div class="section">
                <h3>ğŸ¨ å¡ç‰‡é¡è‰²</h3>
                <div class="color-grid">
                    <div class="color-box active" style="background: white;" data-color="white" title="ç™½è‰²"></div>
                    <div class="color-box" style="background: #ffe8b6;" data-color="cream" title="ç±³è‰²"></div>
                    <div class="color-box" style="background: #ffd4d4;" data-color="pink" title="ç²‰ç´…"></div>
                    <div class="color-box" style="background: #d4f1ff;" data-color="blue" title="å¤©è—"></div>
                    <div class="color-box" style="background: #e8d4ff;" data-color="purple" title="ç´«è‰²"></div>
                    <div class="color-box" style="background: #d4ffd4;" data-color="green" title="ç¶ è‰²"></div>
                </div>
            </div>
            
            <!-- è¨­è¨ˆåƒæ•¸ -->
            <div class="section">
                <h3>âš™ï¸ è¨­è¨ˆåƒæ•¸</h3>
                <div class="form-group">
                    <label>è¤‡é›œåº¦: <span id="complexityValue">2</span>/5</label>
                    <input type="range" id="complexity" min="1" max="5" value="2">
                </div>
            </div>
            
            <!-- ä¿¡æ¯é¡¯ç¤º -->
            <div class="info-box">
                <div class="info-item">
                    <span>è¡¨é¢ç©:</span>
                    <span class="info-value" id="statArea">320</span>
                </div>
                <div class="info-item">
                    <span>é è¨ˆæ·±åº¦:</span>
                    <span class="info-value" id="statDepth">12.0</span>
                </div>
                <div class="info-item">
                    <span>çµæ§‹é¡å‹:</span>
                    <span class="info-value" id="infoMechanism">Vå‹æ‘º</span>
                </div>
            </div>
            
            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="button-row">
                <button class="button btn-primary" id="createBtn">âœ¨ å»ºç«‹æ¨¡å‹</button>
                <button class="button btn-secondary" id="resetBtn">ğŸ”„ é‡ç½®</button>
            </div>
            <button class="button btn-primary" id="exportBtn">ğŸ’¾ å°å‡ºè¨­è¨ˆ</button>
        </div>
        
        <!-- ä¸»è¦ç•«å¸ƒå€ -->
        <div class="main-canvas">
            <div class="drag-hint">ğŸ”ƒ æ‹‰å‹•æ¨¡çµ„ âœ“</div>
            <canvas id="canvas"></canvas>
            <div class="controls-bar">
                <div class="control">
                    <label>æ—‹è½‰ X:</label>
                    <input type="range" id="rotateX" min="0" max="360" value="0">
                </div>
                <div class="control">
                    <label>Y:</label>
                    <input type="range" id="rotateY" min="0" max="360" value="0">
                </div>
                <div class="control">
                    <label>ç¸®æ”¾:</label>
                    <input type="range" id="scale" min="0.5" max="2" value="1" step="0.1">
                </div>
                <button class="button btn-secondary btn-small" id="playAnimation">â–¶ å‹•ç•«</button>
                <button class="button btn-secondary btn-small" id="resetView">ğŸ”„ é‡ç½®è¦–åœ–</button>
                <button class="button btn-secondary btn-small" id="toggleWireframe">â¬œ ç·šæ¡†</button>
            </div>
        </div>
    </div>
    
    <script>
        class PopupCardDesigner {
            constructor() {
                const canvas = document.getElementById('canvas');
                
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf5f7fa);
                this.scene.fog = new THREE.Fog(0xf5f7fa, 100, 200);
                
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                
                this.camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                this.camera.position.set(0, 0, 30);
                
                this.renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
                this.renderer.setSize(width, height);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.shadowMap.enabled = true;
                
                // æ‰“å…‰
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 15, 10);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);
                
                this.cardModel = null;
                this.mechanism = 'vfold';
                this.cardColor = 'white';
                this.isAnimating = false;
                this.pullTabMesh = null;
                this.spinnerMesh = null;
                
                // æ»‘é¼¤æ§åˆ¶çš„ç‹€æ…‹
                this.isDragging = false;
                this.previousMousePosition = { x: 0, y: 0 };
                this.modelRotation = { x: 0, y: 0 };
                
                this.setupEventListeners();
                this.setupMouseControls();
                this.createInitialModel();
                this.animate();
                
                window.addEventListener('resize', () => this.onWindowResize());
            }
            
            setupMouseControls() {
                const canvas = document.getElementById('canvas');
                
                // æ»‘é¼¤æŒ‰ä¸‹
                canvas.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    this.previousMousePosition = { x: e.clientX, y: e.clientY };
                });
                
                // æ»‘é¼¤ç§»å‹•
                document.addEventListener('mousemove', (e) => {
                    if (!this.isDragging) return;
                    
                    const deltaX = e.clientX - this.previousMousePosition.x;
                    const deltaY = e.clientY - this.previousMousePosition.y;
                    
                    // æ»‘é¼¤æ°´å¹³ç¾å‹•æ§åˆ¶Yè»¸æ—‹è½‰
                    // æ»‘é¼¤å«ç›´ç¾å‹•æ§åˆ¶Xè»¸æ—‹è½‰
                    this.modelRotation.y += deltaX * 0.01;
                    this.modelRotation.x += deltaY * 0.01;
                    
                    // é¿å…Xè»¸æ—‹è½‰éå¤§
                    this.modelRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.modelRotation.x));
                    
                    if (this.cardModel) {
                        this.cardModel.rotation.x = this.modelRotation.x;
                        this.cardModel.rotation.y = this.modelRotation.y;
                    }
                    
                    // æ›´æ–°æ»‘ä¸‹æ¡çš„å€¼ï¼ˆå‡†ç¢ºä½ç½®ï¼‰
                    document.getElementById('rotateX').value = (this.modelRotation.x * 180 / Math.PI) % 360;
                    document.getElementById('rotateY').value = (this.modelRotation.y * 180 / Math.PI) % 360;
                    
                    this.previousMousePosition = { x: e.clientX, y: e.clientY };
                });
                
                // æ»‘é¼¤æ”¾é–‹
                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });
                
                // é˜²æ­¢æ»‘é¼¤ç§»å‡ºç”»å¸ƒæ™‚ä¸­æ–·æ‹“å‹•
                canvas.addEventListener('mouseleave', () => {
                    this.isDragging = false;
                });
            }
            
            setupEventListeners() {
                // æ©Ÿåˆ¶é¸æ“‡
                document.querySelectorAll('.option').forEach(opt => {
                    opt.addEventListener('click', (e) => {
                        document.querySelectorAll('.option').forEach(o => o.classList.remove('active'));
                        e.target.classList.add('active');
                        this.mechanism = e.target.dataset.mechanism;
                        this.updateInfo();
                        this.createInitialModel();
                    });
                });
                
                // é¡è‰²é¸æ“‡
                document.querySelectorAll('.color-box').forEach(box => {
                    box.addEventListener('click', (e) => {
                        document.querySelectorAll('.color-box').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.cardColor = e.target.dataset.color;
                        this.createInitialModel();
                    });
                });
                
                // å°ºå¯¸è®Šæ›´
                document.getElementById('cardWidth').addEventListener('change', () => {
                    this.updateInfo();
                    this.createInitialModel();
                });
                document.getElementById('cardHeight').addEventListener('change', () => {
                    this.updateInfo();
                    this.createInitialModel();
                });
                
                // è¤‡é›œåº¦
                document.getElementById('complexity').addEventListener('input', (e) => {
                    document.getElementById('complexityValue').textContent = e.target.value;
                    this.updateInfo();
                });
                
                // æ—‹è½‰æ§åˆ¶ï¼ˆä¸å–æ¶ˆï¼Œå› ç‚ºæ»‘é¼¤ä¹Ÿæœƒæ›´æ–°å®ƒï¼‰
                document.getElementById('rotateX').addEventListener('input', (e) => {
                    this.modelRotation.x = e.target.value * Math.PI / 180;
                    if (this.cardModel) this.cardModel.rotation.x = this.modelRotation.x;
                });
                document.getElementById('rotateY').addEventListener('input', (e) => {
                    this.modelRotation.y = e.target.value * Math.PI / 180;
                    if (this.cardModel) this.cardModel.rotation.y = this.modelRotation.y;
                });
                document.getElementById('scale').addEventListener('input', (e) => {
                    if (this.cardModel) {
                        const s = parseFloat(e.target.value);
                        this.cardModel.scale.set(s, s, s);
                    }
                });
                
                // æŒ‰éˆ•
                document.getElementById('createBtn').addEventListener('click', () => this.createInitialModel());
                document.getElementById('resetBtn').addEventListener('click', () => location.reload());
                document.getElementById('playAnimation').addEventListener('click', (e) => {
                    this.isAnimating = !this.isAnimating;
                    e.target.textContent = this.isAnimating ? 'â¸ åœæ­¢' : 'â–¶ å‹•ç•«';
                });
                document.getElementById('resetView').addEventListener('click', () => {
                    document.getElementById('rotateX').value = 0;
                    document.getElementById('rotateY').value = 0;
                    document.getElementById('scale').value = 1;
                    this.modelRotation = { x: 0, y: 0 };
                    if (this.cardModel) {
                        this.cardModel.rotation.set(0, 0, 0);
                        this.cardModel.scale.set(1, 1, 1);
                    }
                });
                document.getElementById('toggleWireframe').addEventListener('click', () => this.toggleWireframe());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
            }
            
            createInitialModel() {
                if (this.cardModel) this.scene.remove(this.cardModel);
                this.cardModel = new THREE.Group();
                this.scene.add(this.cardModel);
                
                const width = 7.5;
                const height = 10;
                
                // åŸºåº•å¡ç‰‡
                const cardGeom = new THREE.BoxGeometry(width, height, 0.1);
                const material = this.getCardMaterial();
                
                const leftCard = new THREE.Mesh(cardGeom, material);
                leftCard.position.set(-width / 2, 0, 0);
                leftCard.castShadow = true;
                this.cardModel.add(leftCard);
                
                const rightCard = new THREE.Mesh(cardGeom, material);
                rightCard.position.set(width / 2, 0, 0);
                rightCard.castShadow = true;
                this.cardModel.add(rightCard);
                
                // æ ¹æ“šæ©Ÿåˆ¶å‰µå»ºå…ƒç´ 
                switch(this.mechanism) {
                    case 'vfold':
                        this.createVFoldElement(width, height);
                        break;
                    case 'parallel':
                        this.createParallelFoldElement(width, height);
                        break;
                    case 'floating':
                        this.createFloatingElement(width, height);
                        break;
                    case 'pulltab':
                        this.createPullTabElement(width, height);
                        break;
                    case 'spinner':
                        this.createSpinnerElement(width, height);
                        break;
                }
                
                // æ¢è¤‡æ˜¯æ¬¡æœ‰æ‹“å‹•æ™‚çš„æ—‹è½‰ç‹€æ…‹
                this.cardModel.rotation.x = this.modelRotation.x;
                this.cardModel.rotation.y = this.modelRotation.y;
            }
            
            createVFoldElement(width, height) {
                const geometry = new THREE.ConeGeometry(2, 4, 8);
                const material = this.getElementMaterial();
                const cone = new THREE.Mesh(geometry, material);
                cone.position.set(0, 2, 1);
                cone.castShadow = true;
                this.cardModel.add(cone);
            }
            
            createParallelFoldElement(width, height) {
                for (let i = 0; i < 3; i++) {
                    const geom = new THREE.BoxGeometry(width * 0.7, height * 0.6, 0.08);
                    const material = this.getElementMaterial();
                    const box = new THREE.Mesh(geom, material);
                    box.position.z = i * 1.2 + 1;
                    box.castShadow = true;
                    this.cardModel.add(box);
                }
            }
            
            createFloatingElement(width, height) {
                for (let i = 0; i < 4; i++) {
                    const geom = new THREE.BoxGeometry(width * 0.6, height * 0.6, 0.08);
                    const mat = new THREE.MeshStandardMaterial({
                        color: 0xffffff - (i * 0x333333),
                        metalness: 0.3,
                        roughness: 0.4
                    });
                    const layer = new THREE.Mesh(geom, mat);
                    layer.position.z = i * 2 + 1;
                    layer.castShadow = true;
                    this.cardModel.add(layer);
                }
            }
            
            createPullTabElement(width, height) {
                const geom = new THREE.BoxGeometry(width * 0.6, height * 0.5, 0.08);
                const mat = this.getElementMaterial();
                this.pullTabMesh = new THREE.Mesh(geom, mat);
                this.pullTabMesh.position.z = 1;
                this.pullTabMesh.castShadow = true;
                this.cardModel.add(this.pullTabMesh);
            }
            
            createSpinnerElement(width, height) {
                const geom = new THREE.SphereGeometry(1.5, 16, 16);
                const mat = this.getElementMaterial();
                this.spinnerMesh = new THREE.Mesh(geom, mat);
                this.spinnerMesh.position.z = 1.5;
                this.spinnerMesh.castShadow = true;
                this.cardModel.add(this.spinnerMesh);
            }
            
            getCardMaterial() {
                const colors = {
                    'white': 0xffffff,
                    'cream': 0xffe8b6,
                    'pink': 0xffd4d4,
                    'blue': 0xd4f1ff,
                    'purple': 0xe8d4ff,
                    'green': 0xd4ffd4
                };
                return new THREE.MeshStandardMaterial({
                    color: colors[this.cardColor] || 0xffffff,
                    metalness: 0.1,
                    roughness: 0.7
                });
            }
            
            getElementMaterial() {
                return new THREE.MeshStandardMaterial({
                    color: 0xf5a962,
                    metalness: 0.2,
                    roughness: 0.6
                });
            }
            
            updateInfo() {
                const width = parseFloat(document.getElementById('cardWidth').value);
                const height = parseFloat(document.getElementById('cardHeight').value);
                const area = width * height;
                const depth = Math.max(5, 8 + parseInt(document.getElementById('complexity').value) * 2);
                
                document.getElementById('statArea').textContent = area.toFixed(0) + ' cmÂ²';
                document.getElementById('statDepth').textContent = depth.toFixed(1) + ' cm';
                
                const mechanismNames = {
                    'vfold': 'Vå‹æ‘º',
                    'parallel': 'å¹³è¡Œæ‘º',
                    'floating': 'æ‡¸æµ®å±¤',
                    'pulltab': 'æ‹‰å‹•æ©Ÿé—œ',
                    'spinner': 'æ—‹è½‰æ©Ÿé—œ'
                };
                document.getElementById('infoMechanism').textContent = mechanismNames[this.mechanism];
            }
            
            toggleWireframe() {
                this.cardModel.traverse(child => {
                    if (child instanceof THREE.Mesh) {
                        child.material.wireframe = !child.material.wireframe;
                    }
                });
            }
            
            exportData() {
                const data = {
                    projectName: document.getElementById('projectName').value || 'æœªå‘½å',
                    mechanism: this.mechanism,
                    cardWidth: parseFloat(document.getElementById('cardWidth').value),
                    cardHeight: parseFloat(document.getElementById('cardHeight').value),
                    baseCardType: document.getElementById('baseCardType').value,
                    elementCardType: document.getElementById('elementCardType').value,
                    cardColor: this.cardColor,
                    timestamp: new Date().toISOString()
                };
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'popup-card-' + Date.now() + '.json';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (this.isAnimating) {
                    const time = Date.now() * 0.001;
                    if (this.pullTabMesh) {
                        this.pullTabMesh.position.x = Math.sin(time) * 2;
                    }
                    if (this.spinnerMesh) {
                        this.spinnerMesh.rotation.z += 0.02;
                    }
                }
                
                this.renderer.render(this.scene, this.camera);
            }
            
            onWindowResize() {
                const canvas = document.getElementById('canvas');
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(width, height);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new PopupCardDesigner();
        });
    </script>
</body>
</html>